---
title: Rust 学习3
date: 2025-04-05 17:12:57
tags: "Rust"
cover: http://sunowc60i.hd-bkt.clouddn.com/rust.png
---
# 所有权和借用
## 所有权
所有权是 Rust 中的一个重要概念，它决定了变量的生命周期和内存管理。
所有的程序都必须和计算机内存打交道，如何从内存中申请空间来存放程序的运行内容，如何在不需要的时候释放这些空间，成了重中之重，也是所有编程语言设计的难点之一。在计算机语言不断演变过程中，出现了三种流派：
- **垃圾回收机制（GC）** 例如 Java, Python, Go, JavaScript, PHP, Ruby 等语言
- **手动内存管理** 典型代表 C/C++
- **所有权机制** 编译器在编译时会根据一系列规则进行检查，确保程序的内存安全，典型代表 Rust
这种检查只发生在编译期，因此对于程序运行时的性能影响较小，不会有任何性能损失。
由于所有权是一个新概念，因此 Rust 中的所有权机制比较复杂，需要理解一些概念和规则。

本章通过`字符串`和`结构体`来介绍所有权的概念和规则。

--- 
## 一段不安全的代码
```cpp
int* foo() {
  int a; // 变量a的作用域开始
  a = 100;
  char * c = "xyz"; // 变量c的作用域开始
  return &a;
}   // 变量a和c的作用域结束
```
这段代码虽然可以编译通过，但是存在两个问题：
- 变量a的作用域结束后，其内存空间被释放，但是返回的指针指向的内存空间仍然存在，这就造成了内存泄漏。
- 变量c的作用域结束后，其内存空间被释放，但是返回的指针指向的内存空间仍然存在，这就造成了内存泄漏。